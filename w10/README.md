ДЗ OTUS-RDBMS-2019-10 по занятию 10 - MySql: DML: вставка, обновление, удаление, выборка данных
---------------------------------------------------------
Задача: SQL выборка
---------------------------------------------------------

# Table of Contents

1. [Напишите запрос по своей базе с inner join](#inner_join)
2. [Напишите запрос по своей базе с left join](#left_join)
3. [Напишите 5 запросов с WHERE с использованием разных операторов, опишите для чего вам в проекте нужна такая выборка данных](#operators)

Есть например несколько таблиц в базе архива котировок облигаций (tsq).
В одной лежат цены (tsq.prices), в другой доходности (tsq.yields),
в третьей объёмы (tsq.volumes) и т.п.
Связь - по ПК один к одному.

Как-то так:

https://www.notion.so/38753f1d19724f12b66a0b5a8a70539a?v=4d42c9ac71014e31b80cae658e51ccac&p=6cef34d403234183a3aacd3a3485ecac

## 1. Напишите запрос по своей базе с inner join <a name="inner_join"></a>

```
/*
Этот запрос для выборки цен и количества сделок из архива торгов;
INNER JOIN
*/
SELECT
  p.id,
  p.buying_quote bid,
  p.selling_quote ask,
  v.agreement_number
FROM
  tsq.prices p
  INNER JOIN tsq.volumes v ON (v.id = p.id)
LIMIT 10;

mysql> SELECT
    ->   p.id,
    ->   p.buying_quote bid,
    ->   p.selling_quote ask,
    ->   v.agreement_number
    -> FROM
    ->   tsq.prices p
    ->   INNER JOIN tsq.volumes v ON (v.id = p.id)
    -> LIMIT 10;
+-------------------+----------------+----------------+------------------+
| id                | bid            | ask            | agreement_number |
+-------------------+----------------+----------------+------------------+
| 15519040800087637 | 103.0000000000 | 103.6900000000 |                0 |
| 15519040800087643 | 103.9450000000 | 104.0100000000 |                0 |
| 15519040800335069 |  95.0000000000 |  98.8800000000 |                0 |
| 15519040800349363 | 116.2740000000 | 116.4990000000 |                0 |
| 15519040800352301 |  96.0000000000 |  98.8900000000 |                0 |
| 15519040800358599 | 100.0000000000 |   0.0000000000 |                0 |
| 15519040800363777 | 110.9900000000 | 111.5000000000 |                0 |
| 15519040800368459 | 103.0000000000 | 103.9000000000 |                0 |
| 15519040800368487 |  99.5000000000 |   0.0000000000 |                0 |
| 15519040800373049 |  99.5000000000 | 103.8700000000 |                0 |
+-------------------+----------------+----------------+------------------+
10 rows in set (0,00 sec)

```

## 2. Напишите запрос по своей базе с left join <a name="left_join"></a>

```
/*
Этот запрос для выборки записей из архива торгов, по которым вообще нет никаких объёмов
(цены есть всегда, а объёмов может не быть вовсе);
LEFT JOIN
*/
SELECT
  p.id
FROM
  tsq.prices p
  LEFT JOIN tsq.volumes v ON (v.id = p.id)
WHERE
  v.id IS NULL
LIMIT 10;


mysql> SELECT
    ->   p.id
    -> FROM
    ->   tsq.prices p
    ->   LEFT JOIN tsq.volumes v ON (v.id = p.id)
    -> WHERE
    ->   v.id IS NULL
    -> LIMIT 10;
+-------------------+
| id                |
+-------------------+
| 16719040800210799 |
| 16719040800523497 |
| 16719040800524503 |
| 16719040800524767 |
| 16719040800524769 |
| 16719040800524771 |
| 16719040800524781 |
| 16719040800525949 |
| 16719040800526001 |
| 16719040800527543 |
+-------------------+
10 rows in set (0,00 sec)

```

## 3. Напишите 5 запросов с WHERE с использованием разных операторов, опишите для чего вам в проекте нужна такая выборка данных <a name="operators"></a>

```
/*
это запрос для того, чтобы определить, у скольки записей
из архива торгов пошло переполнение по типу int в поле "сумма сделок в деньгах";
Equal operator 
*/
SELECT
  COUNT(1)
FROM
  tsq.volumes v
WHERE
  v.volume_money = 2147483647
;


mysql> SELECT
    ->   COUNT(1)
    -> FROM
    ->   tsq.volumes v
    -> WHERE
    ->   v.volume_money = 2147483647
    -> ;
+----------+
| COUNT(1) |
+----------+
|     4307 |
+----------+
1 row in set (0,01 sec)

```

```
/*
это запрос для того, чтобы определить, у скольки записей
из архива торгов есть валидное значение в поле сумма сделок в деньгах";
Not equal operator, NOT NULL value test
*/
SELECT
  COUNT(1)
FROM
  tsq.volumes v
WHERE
  v.volume_money <> 2147483647
  AND v.volume_money <> 0
  AND v.volume_money IS NOT NULL
;


mysql> SELECT
    ->   COUNT(1)
    -> FROM
    ->   tsq.volumes v
    -> WHERE
    ->   v.volume_money <> 2147483647
    ->   AND v.volume_money <> 0
    ->   AND v.volume_money IS NOT NULL
    -> ;
+----------+
| COUNT(1) |
+----------+
|     4626 |
+----------+
1 row in set (0,01 sec)

```

```
/*
это запрос для того, чтобы оценить количество записей
за первую неделю мая 19-го года
по бирже 167;
используем pk, который у меня составлен из ид биржи, даты и ид облигации
BETWEEN
*/
SELECT
  COUNT(1)
FROM
  tsq.prices p
WHERE
  id BETWEEN 16719050100000000 AND 16719050799999999
;

mysql> SELECT
    ->   COUNT(1)
    -> FROM
    ->   tsq.prices p
    -> WHERE
    ->   id BETWEEN 16719050100000000 AND 16719050799999999
    -> ;
+----------+
| COUNT(1) |
+----------+
|    40600 |
+----------+
1 row in set (0,02 sec)

```

```
/*
То же самое с операторами Greater than or equal и Less than or equal 
*/
SELECT
  COUNT(1)
FROM
  tsq.prices p
WHERE
  id >= 16719050100000000
  AND id <= 16719050799999999
;


mysql> SELECT
    ->   COUNT(1)
    -> FROM
    ->   tsq.prices p
    -> WHERE
    ->   id >= 16719050100000000
    ->   AND id <= 16719050799999999
    -> ;
+----------+
| COUNT(1) |
+----------+
|    40600 |
+----------+
1 row in set (0,02 sec)
```

```
/*
это запрос для того, чтобы выбрать индикативные цены на 1-е мая 19-го года
по облигациям 11208 и 11240 на бирже 167;
оператор IN
*/
SELECT
  p.id,
  p.indicative_price
FROM
  tsq.prices p
WHERE
  id IN (16719050100011208, 16719050100011240)
LIMIT 10
;


mysql> SELECT
    ->   p.id,
    ->   p.indicative_price
    -> FROM
    ->   tsq.prices p
    -> WHERE
    ->   id IN (16719050100011208, 16719050100011240)
    -> LIMIT 10
    -> ;
+-------------------+------------------+
| id                | indicative_price |
+-------------------+------------------+
| 16719050100011208 |    98.8750000000 |
| 16719050100011240 |   100.3500000000 |
+-------------------+------------------+
2 rows in set (0,00 sec)

```